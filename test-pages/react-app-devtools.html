<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React Test App with DevTools - WebSee Testing</title>
    <!-- React DevTools Global Hook - Must be first -->
    <script>
        // Install React DevTools Global Hook before React loads
        window.__REACT_DEVTOOLS_GLOBAL_HOOK__ = {
            renderers: new Map(),
            supportsFiber: true,
            inject: function(renderer) {
                const id = Math.random().toString(16).slice(2);
                this.renderers.set(id, renderer);
            },
            onCommitFiberRoot: function() {},
            onCommitFiberUnmount: function() {},
            getFiberRoots: function() {
                const roots = [];
                this.renderers.forEach((renderer) => {
                    if (renderer.findFiberByHostInstance) {
                        const container = document.getElementById('root');
                        if (container && container._reactRootContainer) {
                            roots.push(container._reactRootContainer._internalRoot);
                        }
                    }
                });
                return roots;
            }
        };
        console.log('React DevTools Hook installed');
    </script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .counter {
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .user-card {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            background: white;
            border-radius: 8px;
        }
        .user-list {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useContext, createContext, useRef } = React;

        // Create a context for testing
        const ThemeContext = createContext({ theme: 'light', setTheme: () => {} });

        function Counter() {
            const [count, setCount] = useState(0);
            const [name, setName] = useState('Counter Component');
            const [isActive, setIsActive] = useState(true);
            const renderCount = useRef(0);

            useEffect(() => {
                renderCount.current += 1;
                console.log(`Counter rendered ${renderCount.current} times with count: ${count}`);
            }, [count]);

            useEffect(() => {
                console.log('Counter component mounted');
                return () => console.log('Counter component unmounted');
            }, []);

            return (
                <div className="counter" data-testid="counter">
                    <h2>{name}</h2>
                    <p>Count: <strong>{count}</strong></p>
                    <p>Active: {isActive ? 'Yes' : 'No'}</p>
                    <p>Render count: {renderCount.current}</p>
                    <button onClick={() => setCount(count + 1)}>Increment</button>
                    <button onClick={() => setCount(count - 1)}>Decrement</button>
                    <button onClick={() => setCount(0)}>Reset</button>
                    <button onClick={() => setIsActive(!isActive)}>Toggle Active</button>
                </div>
            );
        }

        function UserCard({ user }) {
            const renderCount = useRef(0);

            useEffect(() => {
                renderCount.current += 1;
            });

            return (
                <div className="user-card" data-user-id={user.id}>
                    <h3>{user.name}</h3>
                    <p>Email: {user.email}</p>
                    <p>Company: {user.company.name}</p>
                    <p>Renders: {renderCount.current}</p>
                </div>
            );
        }

        function UserList() {
            const [users, setUsers] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);

            const fetchUsers = async () => {
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch('https://jsonplaceholder.typicode.com/users');
                    const data = await response.json();
                    setUsers(data.slice(0, 3));
                } catch (error) {
                    console.error('Error fetching users:', error);
                    setError(error.message);
                } finally {
                    setLoading(false);
                }
            };

            const clearUsers = () => {
                setUsers([]);
            };

            return (
                <div className="user-list" data-testid="user-list">
                    <h2>User List</h2>
                    <button onClick={fetchUsers} disabled={loading}>
                        {loading ? 'Loading...' : 'Load Users'}
                    </button>
                    <button onClick={clearUsers}>Clear Users</button>
                    {error && <p style={{color: 'red'}}>Error: {error}</p>}
                    {loading && <p>Loading users...</p>}
                    {users.map(user => (
                        <UserCard key={user.id} user={user} />
                    ))}
                </div>
            );
        }

        function ErrorBoundary({ children }) {
            const [hasError, setHasError] = useState(false);
            const [error, setError] = useState(null);

            if (hasError) {
                return (
                    <div style={{padding: '20px', background: '#ffebee', borderRadius: '8px'}}>
                        <h2>Something went wrong!</h2>
                        <p>{error?.toString()}</p>
                        <button onClick={() => { setHasError(false); setError(null); }}>
                            Reset
                        </button>
                    </div>
                );
            }

            return children;
        }

        function ErrorComponent() {
            const [shouldError, setShouldError] = useState(false);

            const triggerError = () => {
                setShouldError(true);
                throw new Error('Test error from React component');
            };

            if (shouldError) {
                return <div>Error occurred!</div>;
            }

            return (
                <div style={{padding: '20px', background: 'white', borderRadius: '8px', margin: '20px 0'}}>
                    <h2>Error Testing</h2>
                    <button onClick={triggerError}>Trigger Error</button>
                </div>
            );
        }

        function ThemeProvider({ children }) {
            const [theme, setTheme] = useState('light');

            return (
                <ThemeContext.Provider value={{ theme, setTheme }}>
                    {children}
                </ThemeContext.Provider>
            );
        }

        function ThemedComponent() {
            const { theme, setTheme } = useContext(ThemeContext);

            return (
                <div style={{
                    padding: '20px',
                    background: theme === 'light' ? 'white' : '#333',
                    color: theme === 'light' ? 'black' : 'white',
                    borderRadius: '8px',
                    margin: '20px 0'
                }}>
                    <h2>Themed Component</h2>
                    <p>Current theme: {theme}</p>
                    <button onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}>
                        Toggle Theme
                    </button>
                </div>
            );
        }

        function App() {
            const [showCounter, setShowCounter] = useState(true);

            return (
                <ThemeProvider>
                    <div>
                        <h1>WebSee React Test Application (with DevTools)</h1>
                        <p>This page has React DevTools hooks enabled for component inspection.</p>

                        <button onClick={() => setShowCounter(!showCounter)}>
                            {showCounter ? 'Hide' : 'Show'} Counter
                        </button>

                        {showCounter && <Counter />}
                        <UserList />
                        <ThemedComponent />
                        <ErrorBoundary>
                            <ErrorComponent />
                        </ErrorBoundary>
                    </div>
                </ThemeProvider>
            );
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

        // Log that React is ready
        console.log('React app rendered');
        console.log('React DevTools Hook:', window.__REACT_DEVTOOLS_GLOBAL_HOOK__);
        console.log('Renderers:', window.__REACT_DEVTOOLS_GLOBAL_HOOK__.renderers);
    </script>
</body>
</html>
